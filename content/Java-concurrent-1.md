+++
title = "Javaå¹¶å‘æ€»ç»“ï¼ˆä¸€ï¼‰"
date = 2019-09-25

[taxonomies]
tags = ["Java"]
categories = ["Interview"]
+++

æœ¬æ–‡åªæ˜¯å¯¹Javaå¹¶å‘çŸ¥è¯†çš„ä¸€ä¸ªæ€»ç»“, Javaå¹¶å‘æ˜¯ä¸€ä¸ªå¾ˆéš¾çš„é—®é¢˜ï¼Œä¸æ˜¯ä¸€ç¯‡åšæ–‡èƒ½å¤Ÿè¯´æ¸…ï¼Œä»¥åè¿˜éœ€åœ¨å®è·µä¸­å¤šå¤šç§¯ç´¯å­¦ä¹ æ‰æ˜¯ã€‚

<!-- more -->

## å¤šçº¿ç¨‹çš„æ¦‚å¿µ
 å¤šçº¿ç¨‹ç¨‹åºåœ¨è¾ƒä½çš„å±‚æ¬¡ä¸Šæ‰©å±•äº†å¤šä»»åŠ¡çš„æ¦‚å¿µï¼šä¸€ä¸ªç¨‹åºåŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚é€šå¸¸ï¼Œ
æ¯ä¸€ä¸ªä»»åŠ¡ç§°ä¸ºä¸€ä¸ªçº¿ç¨‹ï¼ˆ thread), å®ƒæ˜¯çº¿ç¨‹æ§åˆ¶çš„ç®€ç§°ã€‚å¯ä»¥åŒæ—¶è¿è¡Œä¸€ä¸ªä»¥ä¸Šçº¿ç¨‹çš„ç¨‹
åºç§°ä¸ºå¤šçº¿ç¨‹ç¨‹åºï¼ˆmultithreaded)ã€‚
é‚£ä¹ˆï¼Œå¤šè¿›ç¨‹ä¸å¤šçº¿ç¨‹æœ‰å“ªäº›åŒºåˆ«å‘¢ï¼Ÿ æœ¬è´¨çš„åŒºåˆ«åœ¨äºæ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰è‡ªå·±çš„ä¸€æ•´å¥—å˜
é‡ï¼Œ è€Œçº¿ç¨‹åˆ™å…±äº«æ•°æ®ã€‚ è¿™å¬èµ·æ¥ä¼¼ä¹æœ‰äº›é£é™©ï¼Œ çš„ç¡®ä¹Ÿæ˜¯è¿™æ ·ï¼Œ åœ¨æœ¬ç« ç¨åå°†å¯ä»¥çœ‹åˆ°è¿™
ä¸ªé—®é¢˜ã€‚ç„¶è€Œï¼Œå…±äº«å˜é‡ä½¿çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æ¯”è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æ›´æœ‰æ•ˆã€ æ›´å®¹æ˜“ã€‚ æ­¤å¤–ï¼Œ åœ¨æœ‰
äº›æ“ä½œç³»ç»Ÿä¸­ï¼Œä¸è¿›ç¨‹ç›¸æ¯”è¾ƒï¼Œ çº¿ç¨‹æ›´â€œ è½»é‡çº§â€ï¼Œ åˆ›å»ºã€ æ’¤é”€ä¸€ä¸ªçº¿ç¨‹æ¯”å¯åŠ¨æ–°è¿›ç¨‹çš„å¼€
é”€è¦å°å¾—å¤šã€‚

## çº¿ç¨‹çŠ¶æ€
Javaçº¿ç¨‹åŒ…å«å¦‚ä¸‹çŠ¶æ€ï¼š
- new(æ–°åˆ›å»º)
- Runnable(å¯è¿è¡Œ)
- Blocked(è¢«é˜»å¡)
- Waiting(ç­‰å¾…)
- Timed waiting(è®¡æ—¶ç­‰å¾…)
- Terminated(è¢«ç»ˆæ­¢)
- [Java SE9 Enum Thread.State](https://docs.oracle.com/javase/9/docs/api/java/lang/Thread.State.html)

## çº¿ç¨‹å±æ€§
Javaçº¿ç¨‹åŒ…å«å¦‚ä¸‹å±æ€§ï¼š
- Priority(ä¼˜å…ˆçº§)
- Daemon thread(å®ˆæŠ¤çº¿ç¨‹)
- æœªæ•è·å¼‚å¸¸å¤„ç†
### ä¼˜å…ˆçº§
```java
public final static int MIN_PRIORITY = 1;

public final static int NORM_PRIORITY = 5;

public final static int MAX_PRIORITY = 10;

public final void setPriority(int newPriority) {
    ThreadGroup g;
    checkAccess();
    if (newPriority > MAX_PRIORITY || newPriority < MIN_PRIORITY) {
        throw new IllegalArgumentException();
    }
    if ((g = getThreadGroup()) != null) {
        if (newPriority > g.getMaxPriority()) {
            newPriority = g.getMaxPriority();
        }
        setPriority0(priority = newPriority);
    }
}
```
Javaçº¿ç¨‹ä¼˜å…ˆçº§é»˜è®¤å€¼ä¸º5ï¼Œå–å€¼åŒºé—´ä¸º1-10çš„ä¸€ä¸ªæ•´æ•°

### å®ˆæŠ¤çº¿ç¨‹
```java
public final void setDaemon(boolean on) {
    checkAccess();
    if (isAlive()) {
        throw new IllegalThreadStateException();
    }
    daemon = on;
}
```
```java
public static void main(String[] args) {
    Thread thread = new Thread(new MyRunnable());
    thread.setDaemon(true);
}
```
å®ˆæŠ¤çº¿ç¨‹æ˜¯ç¨‹åºè¿è¡Œæ—¶åœ¨åå°æä¾›æœåŠ¡çš„çº¿ç¨‹ï¼Œä¸å±äºç¨‹åºä¸­ä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†ã€‚

å½“æ‰€æœ‰éå®ˆæŠ¤çº¿ç¨‹ç»“æŸæ—¶ï¼Œç¨‹åºä¹Ÿå°±ç»ˆæ­¢ï¼ŒåŒæ—¶ä¼šæ€æ­»æ‰€æœ‰å®ˆæŠ¤çº¿ç¨‹ã€‚

main() å±äºéå®ˆæŠ¤çº¿ç¨‹ã€‚

åœ¨çº¿ç¨‹å¯åŠ¨ä¹‹å‰ä½¿ç”¨ setDaemon() æ–¹æ³•å¯ä»¥å°†ä¸€ä¸ªçº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚
## çº¿ç¨‹åˆ›å»ºæ–¹å¼
æœ‰ä¸‰ç§ä½¿ç”¨çº¿ç¨‹çš„æ–¹å¼ï¼š
- å®ç°Runnableæ¥å£
- å®ç°Callableæ¥å£
- ç»§æ‰¿Threadç±»
## çº¿ç¨‹æ± 
### Executorçš„ç±»å‹
Executor ç®¡ç†å¤šä¸ªå¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œï¼Œè€Œæ— éœ€ç¨‹åºå‘˜æ˜¾å¼åœ°ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™é‡Œçš„å¼‚æ­¥æ˜¯æŒ‡å¤šä¸ªä»»åŠ¡çš„æ‰§è¡Œäº’ä¸å¹²æ‰°ï¼Œä¸éœ€è¦è¿›è¡ŒåŒæ­¥æ“ä½œã€‚
ä¸»è¦æœ‰ä¸‰ç§Executorï¼š
- CachedThreadPoolï¼šä¸€ä¸ªä»»åŠ¡åˆ›å»ºä¸€ä¸ªçº¿ç¨‹
- FixedThreadPoolï¼šæ‰€æœ‰ä»»åŠ¡åªèƒ½ä½¿ç”¨å›ºå®šå¤§å°çš„çº¿ç¨‹
- SingleThreadExecutorï¼šç›¸å½“äºå¤§å°ä¸º 1 çš„ FixedThreadPool

### Executorçš„ä¸­æ–­æ“ä½œ
è°ƒç”¨ Executor çš„ shutdown() æ–¹æ³•ä¼šç­‰å¾…çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•ä¹‹åå†å…³é—­ï¼Œä½†æ˜¯å¦‚æœè°ƒç”¨çš„æ˜¯ shutdownNow() æ–¹æ³•ï¼Œåˆ™ç›¸å½“äºè°ƒç”¨æ¯ä¸ªçº¿ç¨‹çš„ interrupt() æ–¹æ³•
```java
private static final int CORE_POOL_SIZE = 5;
private static final int MAX_POOL_SIZE = 10;
private static final int QUEUE_CAPACITY = 100;
private static final Long KEEP_ALIVE_TIME = 1L;

public static void main(String[] args) {

    //ä½¿ç”¨é˜¿é‡Œå·´å·´æ¨èçš„åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹å¼
    //é€šè¿‡ThreadPoolExecutoræ„é€ å‡½æ•°è‡ªå®šä¹‰å‚æ•°åˆ›å»º
    ThreadPoolExecutor executor = new ThreadPoolExecutor(
            CORE_POOL_SIZE,
            MAX_POOL_SIZE,
            KEEP_ALIVE_TIME,
            TimeUnit.SECONDS,
            new ArrayBlockingQueue<>(QUEUE_CAPACITY),
            new ThreadPoolExecutor.CallerRunsPolicy());
}
```
å¦‚æœåªæƒ³ä¸­æ–­ Executor ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ submit() æ–¹æ³•æ¥æäº¤ä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª Future<?> å¯¹è±¡ï¼Œé€šè¿‡è°ƒç”¨è¯¥å¯¹è±¡çš„ cancel(true) æ–¹æ³•å°±å¯ä»¥ä¸­æ–­çº¿ç¨‹
```java
Future<?> future = executorService.submit(() -> {
    // ..
});
future.cancel(true);
```
## åŒæ­¥
> çº¿ç¨‹ä¹‹é—´æ˜¯æœ‰å…±äº«å†…å­˜çš„ï¼Œä¸ºäº†é˜²æ­¢è¿è¡Œæ—¶å‡ºç°æ•°æ®ç«äº‰ï¼ŒJavaæä¾›äº†ä¸€ç³»åˆ—çš„å·¥å…·æ¥è§£å†³è¿™ä¸ªé—®é¢˜
### Synchronized
å†…ç½®é”ï¼Œå½“å®ƒç”¨æ¥ä¿®é¥°ä¸€ä¸ªæ–¹æ³•æˆ–è€…ä»£ç å—çš„æ—¶å€™ï¼Œèƒ½å¤Ÿä¿è¯åœ¨åŒä¸€æ—¶åˆ»æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¯¥æ®µä»£ç ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å¿…é¡»ç­‰å¾…å½“å‰çº¿ç¨‹æ‰§è¡Œå®Œä»¥åæ‰èƒ½æ‰§è¡Œè¯¥æ®µä»£ç ï¼ˆæœªæ‰§è¡Œä¹‹å‰ï¼Œè¯¥çº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€ï¼‰ã€‚åŒæ—¶å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¯é‡å…¥é”ã€‚

1. åŒæ­¥ä¸€ä¸ªç±»
```java
public static Singleton getInstance() {
    if (singleton == null) {
        synchronized (Singleton.class) {
            if (singleton == null) {
                singleton = new Singleton();
            }
        }
    }
    return singleton;
}
```
ä¸Šè¿°ä»£ç ä½œç”¨äºæ•´ä¸ªç±»ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸¤ä¸ªçº¿ç¨‹è°ƒç”¨åŒä¸€ä¸ªç±»çš„ä¸åŒå¯¹è±¡ä¸Šçš„è¿™ç§åŒæ­¥è¯­å¥ï¼Œä¹Ÿä¼šè¿›è¡ŒåŒæ­¥ã€‚(å¦‚æœé”ä½this,é‚£ä¹ˆå°±åªæœ‰åŒä¸€ä¸ªå¯¹è±¡çš„åŒæ­¥è¯­å¥æ‰ä¼šè¿›è¡ŒåŒæ­¥)

2. åŒæ­¥ä¸€ä¸ªæ–¹æ³•
```java
public synchronized void func () {
    // ...
}
```
ä½œç”¨äºåŒä¸€ä¸ªå¯¹è±¡ã€‚

### ReentrantLock
ReentrantLock æ˜¯ java.util.concurrentï¼ˆJ.U.Cï¼‰åŒ…ä¸­çš„é”
```java
public class LockExample {

    private Lock lock = new ReentrantLock();

    public void func() {
        lock.lock();
        try {
            for (int i = 0; i < 10; i++) {
                System.out.print(i + " ");
            }
        } finally {
            // ç¡®ä¿é‡Šæ”¾é”ï¼Œä»è€Œé¿å…å‘ç”Ÿæ­»é”
            lock.unlock();
        }
    }
}
```
### æ¯”è¾ƒ
1. é”çš„å®ç°
synchronized æ˜¯ JVM å®ç°çš„ï¼Œè€Œ ReentrantLock æ˜¯ JDK å®ç°çš„ã€‚
2. æ€§èƒ½
æ–°ç‰ˆæœ¬ Java å¯¹ synchronized è¿›è¡Œäº†å¾ˆå¤šä¼˜åŒ–ï¼Œä¾‹å¦‚è‡ªæ—‹é”ç­‰ï¼Œsynchronized ä¸ ReentrantLock å¤§è‡´ç›¸åŒã€‚
3. ç­‰å¾…å¯ä¸­æ–­
å½“æŒæœ‰é”çš„çº¿ç¨‹é•¿æœŸä¸é‡Šæ”¾é”çš„æ—¶å€™ï¼Œæ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹å¯ä»¥é€‰æ‹©æ”¾å¼ƒç­‰å¾…ï¼Œæ”¹ä¸ºå¤„ç†å…¶ä»–äº‹æƒ…ã€‚ReentrantLock å¯ä¸­æ–­ï¼Œè€Œ synchronized ä¸è¡Œã€‚
4. å…¬å¹³é”
å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…åŒä¸€ä¸ªé”æ—¶ï¼Œå¿…é¡»æŒ‰ç…§ç”³è¯·é”çš„æ—¶é—´é¡ºåºæ¥ä¾æ¬¡è·å¾—é”ã€‚
å…¬å¹³é”å°†ç”±äºåœ¨æŒ‚èµ·çº¿ç¨‹å’Œæ¢å¤çº¿ç¨‹æ—¶å­˜åœ¨çš„å¼€é”€è€Œæå¤§çš„é™ä½æ•ˆç‡ã€‚
è€Œéå…¬å¹³é”ç”±äºæ˜¯åœ¨è¯·æ±‚æ—¶é”å·²ç»ä¸ºå¯ç”¨çŠ¶æ€å°±ç›´æ¥è·å–ï¼Œä¸éœ€è¦è¿›è¡Œä»€ä¹ˆé¢å¤–çš„æ“ä½œï¼Œå› æ­¤æ•ˆç‡æ›´é«˜ã€‚
synchronized ä¸­çš„é”æ˜¯éå…¬å¹³çš„ï¼ŒReentrantLock é»˜è®¤æƒ…å†µä¸‹ä¹Ÿæ˜¯éå…¬å¹³çš„ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æ˜¯å…¬å¹³çš„ã€‚
5. é”ç»‘å®šå¤šä¸ªæ¡ä»¶
ä¸€ä¸ª ReentrantLock å¯ä»¥åŒæ—¶ç»‘å®šå¤šä¸ª Condition å¯¹è±¡ã€‚

## çº¿ç¨‹ä¹‹é—´çš„åä½œ
å½“å¤šä¸ªçº¿ç¨‹å¯ä»¥ä¸€èµ·å·¥ä½œå»è§£å†³æŸä¸ªé—®é¢˜æ—¶ï¼Œå¦‚æœæŸäº›éƒ¨åˆ†å¿…é¡»åœ¨å…¶å®ƒéƒ¨åˆ†ä¹‹å‰å®Œæˆï¼Œé‚£ä¹ˆå°±éœ€è¦å¯¹çº¿ç¨‹è¿›è¡Œåè°ƒã€‚

### join()
åœ¨çº¿ç¨‹ä¸­è°ƒç”¨å¦ä¸€ä¸ªçº¿ç¨‹çš„ join() æ–¹æ³•ï¼Œä¼šå°†å½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œè€Œä¸æ˜¯å¿™ç­‰å¾…ï¼Œç›´åˆ°ç›®æ ‡çº¿ç¨‹ç»“æŸã€‚

### wait()  / notify() /  notifyAll()
- è°ƒç”¨ wait() ä½¿å¾—çº¿ç¨‹ç­‰å¾…æŸä¸ªæ¡ä»¶æ»¡è¶³ï¼Œçº¿ç¨‹åœ¨ç­‰å¾…æ—¶ä¼šè¢«æŒ‚èµ·ï¼Œå½“å…¶ä»–çº¿ç¨‹çš„è¿è¡Œä½¿å¾—è¿™ä¸ªæ¡ä»¶æ»¡è¶³æ—¶ï¼Œå…¶å®ƒçº¿ç¨‹ä¼šè°ƒç”¨ notify() æˆ–è€… notifyAll() æ¥å”¤é†’æŒ‚èµ·çš„çº¿ç¨‹ã€‚
- å®ƒä»¬éƒ½å±äº Object çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸å±äº Threadã€‚
- åªèƒ½ç”¨åœ¨åŒæ­¥æ–¹æ³•æˆ–è€…åŒæ­¥æ§åˆ¶å—ä¸­ä½¿ç”¨ï¼Œå¦åˆ™ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡º IllegalMonitorStateExceptionã€‚
- ä½¿ç”¨ wait() æŒ‚èµ·æœŸé—´ï¼Œçº¿ç¨‹ä¼šé‡Šæ”¾é”ã€‚è¿™æ˜¯å› ä¸ºï¼Œå¦‚æœæ²¡æœ‰é‡Šæ”¾é”ï¼Œé‚£ä¹ˆå…¶å®ƒçº¿ç¨‹å°±æ— æ³•è¿›å…¥å¯¹è±¡çš„åŒæ­¥æ–¹æ³•æˆ–è€…åŒæ­¥æ§åˆ¶å—ä¸­ï¼Œé‚£ä¹ˆå°±æ— æ³•æ‰§è¡Œ notify() æˆ–è€… notifyAll() æ¥å”¤é†’æŒ‚èµ·çš„çº¿ç¨‹ï¼Œé€ æˆæ­»é”ã€‚

### wait() å’Œ sleep() çš„åŒºåˆ«
- wait() æ˜¯ Object çš„æ–¹æ³•ï¼Œè€Œ sleep() æ˜¯ Thread çš„é™æ€æ–¹æ³•ã€‚
- wait() ä¼šé‡Šæ”¾é”ï¼Œsleep() ä¸ä¼šã€‚

### await() / signal() / signalAll()
- java.util.concurrent ç±»åº“ä¸­æä¾›äº† Condition ç±»æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„åè°ƒï¼Œå¯ä»¥åœ¨ Condition ä¸Šè°ƒç”¨ await() æ–¹æ³•ä½¿çº¿ç¨‹ç­‰å¾…ï¼Œå…¶å®ƒçº¿ç¨‹è°ƒç”¨ signal() æˆ– signalAll() æ–¹æ³•å”¤é†’ç­‰å¾…çš„çº¿ç¨‹ã€‚
- ç›¸æ¯”äº wait() è¿™ç§ç­‰å¾…æ–¹å¼ï¼Œawait() å¯ä»¥æŒ‡å®šç­‰å¾…çš„æ¡ä»¶ï¼Œå› æ­¤æ›´åŠ çµæ´»ã€‚
- ä½¿ç”¨ Lock æ¥è·å–ä¸€ä¸ª Condition å¯¹è±¡ã€‚

## å°ç»“
è¿™æ¬¡æ€»ç»“äº†çº¿ç¨‹çš„åŸºæœ¬æ¦‚å¿µï¼Œä»¥åŠé”çš„è¿ç”¨ï¼Œä¸‹æ¬¡ä»‹ç»ä¸‹Javaå¹¶å‘ç¼–ç¨‹çš„å·¥å…·ç®±ğŸ˜„

## å‚è€ƒ
- ã€ŠJavaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹
- ã€ŠJavaæ ¸å¿ƒæŠ€æœ¯ï¼ˆå·ä¸€ï¼‰ã€‹ç¬¬åå››ç« 
- [CS-NOTES](https://github.com/CyC2018/CS-Notes/blob/master/notes/Java%20%E5%B9%B6%E5%8F%91.md)
